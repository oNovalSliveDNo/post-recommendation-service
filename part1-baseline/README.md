# üöÄ –§–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç (1/4)

## –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö + ORM + FastAPI

–ß–∞—Å—Ç—å 1 ‚Äî Backend-—Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î –∏ baseline —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

---

## üìå –ó–∞–¥–∞—á–∞

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å backend-—Å–µ—Ä–≤–∏—Å –Ω–∞ **FastAPI**, –∫–æ—Ç–æ—Ä—ã–π:

1. –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ PostgreSQL –±–∞–∑–µ `startml`
2. –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ **SQLAlchemy ORM**
3. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:

   * –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   * –¥–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç–∞
   * –¥–µ–π—Å—Ç–≤–∏—è –∏–∑ `feed_action`
   * üî• —Ç–æ–ø-N –ø–æ—Å—Ç–æ–≤ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ª–∞–π–∫–æ–≤ (`/post/recommendations/`)

–≠—Ç–æ –ø–µ—Ä–≤–∞—è —á–∞—Å—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –∫—É—Ä—Å–∞.
–û–Ω–∞ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –±–∞–∑–æ–≤—ã–π backend, –∫–æ—Ç–æ—Ä—ã–π –¥–∞–ª–µ–µ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è ML-–º–æ–¥–µ–ª—å—é –∏ A/B-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º.

---

## üóÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —á–∞—Å—Ç–∏ 1

```
part1-baseline
‚îú‚îÄ‚îÄ app.py
‚îú‚îÄ‚îÄ database.py
‚îú‚îÄ‚îÄ schema.py
‚îú‚îÄ‚îÄ table_user.py
‚îú‚îÄ‚îÄ table_post.py
‚îú‚îÄ‚îÄ table_feed.py
‚îî‚îÄ‚îÄ README.md
```

---

## üõ† –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1Ô∏è‚É£ ORM-–º–æ–¥–µ–ª–∏

–û–±–µ—Ä–Ω—É—Ç—ã —Ç–∞–±–ª–∏—Ü—ã:

* `user` ‚Üí `User`
* `post` ‚Üí `Post`
* `feed_action` ‚Üí `Feed`

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `declarative_base()`.

–í `Feed`:

* –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã `ForeignKey`
* –¥–æ–±–∞–≤–ª–µ–Ω—ã `relationship` –∫ `User` –∏ `Post`

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —á–µ—Ä–µ–∑ Pydantic.

---

### 2Ô∏è‚É£ Pydantic-—Å—Ö–µ–º—ã

* `UserGet`
* `PostGet`
* `FeedGet`

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `from_attributes = True`.

`FeedGet` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã:

```json
{
  "user_id": 1,
  "post_id": 10,
  "action": "like",
  "time": "...",
  "user": {...},
  "post": {...}
}
```

---

### 3Ô∏è‚É£ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

#### üìç –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

```
GET /user/{id}
```

#### üìç –ü–æ—Å—Ç

```
GET /post/{id}
```

#### üìç Feed –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```
GET /user/{id}/feed?limit=10
```

#### üìç Feed –ø–æ—Å—Ç–∞

```
GET /post/{id}/feed?limit=10
```

–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –ø–æ `time DESC`.

---

## üî• Baseline —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

```
GET /post/recommendations/?limit=10
```

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ø-N –ø–æ—Å—Ç–æ–≤ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ª–∞–π–∫–æ–≤.

–õ–æ–≥–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:

* —Ñ–∏–ª—å—Ç—Ä `action = 'like'`
* `GROUP BY post_id`
* —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ `COUNT DESC`
* `LIMIT`

–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:

```json
[
  {
    "id": 123,
    "text": "Some post text",
    "topic": "business"
  },
  {
    "id": 456,
    "text": "Another post",
    "topic": "movie"
  }
]
```

–≠—Ç–æ baseline –ø–µ—Ä–µ–¥ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ–º ML-–º–æ–¥–µ–ª–∏ –≤–æ 2 —á–∞—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞.

---

## ‚öô –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ

1Ô∏è‚É£ –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ —à–∞–±–ª–æ–Ω–∞:

```bash
cp .env.example .env
```

2Ô∏è‚É£ –£–∫–∞–∂–∏—Ç–µ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:

```
SQLALCHEMY_DATABASE_URL=postgresql://robot-startml-ro:your_password_here@postgres.lab.karpov.courses:6432/startml
```

`database.py` –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —á–µ—Ä–µ–∑ `python-dotenv`.

‚ö† –§–∞–π–ª `.env` –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è.

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–í –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è `requirements.txt`.

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:

```bash
python -m venv venv
```

–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å:

**Linux / Mac:**

```bash
source venv/bin/activate
```

**Windows:**

```powershell
venv\Scripts\activate
```

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
pip install -r requirements.txt
```

---

## ‚ñ∂ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é:

```bash
cd part1-baseline
```

–ó–∞–ø—É—Å–∫:

```bash
uvicorn app:app --reload
```

Swagger-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:

```
http://127.0.0.1:8000/docs
```

---
f
## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

* ORM –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç—Ä–∞–∂–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î
* –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏
* –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã endpoint –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, –ø–æ—Å—Ç–∞–º–∏ –∏ feed
* Feed –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
* Baseline —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
* –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º —á–∞—Å—Ç–∏ 1 —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

---

## üìé –°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø

–ß–∞—Å—Ç—å 2 ‚Äî –æ–±—É—á–µ–Ω–∏–µ ML-–º–æ–¥–µ–ª–∏ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –µ—ë –≤ —Å–µ—Ä–≤–∏—Å.
