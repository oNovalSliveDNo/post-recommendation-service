# üß™ –§–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç (4/4)

## A/B-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã

–ß–∞—Å—Ç—å 4 ‚Äî –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –æ–Ω–ª–∞–π–Ω-—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –º–æ–¥–µ–ª–µ–π.

‚¨ÖÔ∏è [–ß–∞—Å—Ç—å 1: Backend + ORM + Baseline](https://github.com/oNovalSliveDNo/post-recommendation-service/tree/main/part1-baseline#readme)  
‚¨ÖÔ∏è [–ß–∞—Å—Ç—å 2: ML-–º–æ–¥–µ–ª—å + Production inference](https://github.com/oNovalSliveDNo/post-recommendation-service/tree/main/part2-ml-model#readme)  
‚¨ÖÔ∏è [–ß–∞—Å—Ç—å 3: NLP + DL –ø—Ä–∏–∑–Ω–∞–∫–∏](https://github.com/oNovalSliveDNo/post-recommendation-service/tree/main/part3-nlp-enhanced#readme)  

---

## üìå –ó–∞–¥–∞—á–∞

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å A/B-—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –¥–≤—É—Ö –º–æ–¥–µ–ª–µ–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π:

* **control** ‚Äî –º–æ–¥–µ–ª—å –∏–∑ —á–∞—Å—Ç–∏ 2
* **test** ‚Äî –º–æ–¥–µ–ª—å –∏–∑ —á–∞—Å—Ç–∏ 3

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

1Ô∏è‚É£ –î–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –≥—Ä—É–ø–ø—ã 50/50  
2Ô∏è‚É£ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –º–æ–¥–µ–ª–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≥—Ä—É–ø–ø—ã  
3Ô∏è‚É£ –í–æ–∑–≤—Ä–∞—â–∞—Ç—å –≥—Ä—É–ø–ø—É –≤ –æ—Ç–≤–µ—Ç–µ API  
4Ô∏è‚É£ –ü—Ä–æ–≤–µ—Å—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤  

---

# ‚öôÔ∏è –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–µ—Ä–≤–∏—Å–µ

## 1Ô∏è‚É£ –†–∞–∑–±–∏–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è hash-—Ñ—É–Ω–∫—Ü–∏—è `md5` + —Å–æ–ª—å:

```python
SALT = "my_salt"
```

```python
percent = md5(user_id + SALT) % 100
```

* `< 50` ‚Üí `control`
* `>= 50` ‚Üí `test`

üìå –†–∞–∑–±–∏–µ–Ω–∏–µ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ  
üìå –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `exp_group` –∏–∑ —Ç–∞–±–ª–∏—Ü—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## 2Ô∏è‚É£ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–≤—É—Ö –º–æ–¥–µ–ª–µ–π

```python
model_control = load_models("control")
model_test = load_models("test")
```

–§–∞–π–ª—ã:

```
model_control.cbm
model_test.cbm
```

---

## 3Ô∏è‚É£ –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API

–¢–µ–ø–µ—Ä—å endpoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:

```json
{
  "exp_group": "control",
  "recommendations": [...]
}
```

–ú–æ–¥–µ–ª—å –æ—Ç–≤–µ—Ç–∞:

```python
class Response(BaseModel):
    exp_group: str
    recommendations: List[PostGet]
```

---

# üìä –ê–Ω–∞–ª–∏–∑ A/B-—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞

–§–∞–π–ª:

```
ab_analysis.ipynb
```

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –¥–∞–Ω–Ω—ã–µ:

* `views.csv` ‚Äî –ª–æ–≥–∏ –ø–æ–∫–∞–∑–æ–≤ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
* `likes.csv` ‚Äî –ª–æ–≥–∏ –ª–∞–π–∫–æ–≤

---

# üß© –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞

## 1Ô∏è‚É£ –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –≥—Ä—É–ø–ø

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –ø–æ–ø–∞–≤—à–∏–µ –≤ –æ–±–µ –≥—Ä—É–ø–ø—ã: **4**  
–£–¥–∞–ª–µ–Ω—ã –∏–∑ –∞–Ω–∞–ª–∏–∑–∞.

---

## 2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ 50/50

| –ì—Ä—É–ø–ø–∞  | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| ------- | ------------- |
| control | 32350         |
| test    | 32659         |

–ë–∏–Ω–æ–º–∏–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç:

```
p-value = 0.227
```

‚úî –†–∞–∑–±–∏–µ–Ω–∏–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç 50/50

---

# üìà –ú–µ—Ç—Ä–∏–∫–∏

## üë§ User-level

### 1Ô∏è‚É£ –î–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å ‚â•1 –ª–∞–π–∫–æ–º

| –ì—Ä—É–ø–ø–∞  | –î–æ–ª—è   |
| ------- | ------ |
| control | 0.8913 |
| test    | 0.8982 |

Z-test:

```
p-value = 0.004455
```

‚úî –†–∞–∑–ª–∏—á–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º–æ

---

### 2Ô∏è‚É£ –ß–∏—Å–ª–æ –ª–∞–π–∫–æ–≤ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω Mann‚ÄìWhitney U test  
(—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ)

```
p-value = 0.000030
```

‚úî –†–∞–∑–ª–∏—á–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º–æ

---

## üëÄ View-level

### Hitrate (–¥–æ–ª—è –ø–æ–∫–∞–∑–æ–≤ —Å ‚â•1 –ª–∞–π–∫–æ–º)

| –ì—Ä—É–ø–ø–∞  | Hitrate |
| ------- | ------- |
| control | 0.7067  |
| test    | 0.7198  |

–†–∞–∑–Ω–∏—Ü–∞:

```
+1.32 –ø.–ø.
```

---

## üì¶ Bucket-based –∞–Ω–∞–ª–∏–∑ (100 –±–∞–∫–µ—Ç–æ–≤)

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω hash(user_id) % 100  
–î–∞–ª–µ–µ t-test –ø–æ bucket CTR.

```
p-value ‚âà 0.000000
```

‚úî –†–∞–∑–ª–∏—á–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º–æ

---

# üéØ –ò—Ç–æ–≥ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞

‚úî –î–æ–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤—ã—Ä–æ—Å–ª–∞  
‚úî –ß–∏—Å–ª–æ –ª–∞–π–∫–æ–≤ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—ã—Ä–æ—Å–ª–æ  
‚úî Hitrate —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –≤—ã—à–µ –≤ test  
‚úî –†–∞–∑–ª–∏—á–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ (Œ± = 0.05)

üìå **–¢–µ—Å—Ç–æ–≤–∞—è –º–æ–¥–µ–ª—å (NLP + DL) —É–ª—É—á—à–∞–µ—Ç –≤–æ–≤–ª–µ—á—ë–Ω–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.**

---

# üóÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —á–∞—Å—Ç–∏ 4

```
part4-ab-testing
‚îú‚îÄ‚îÄ app.py
‚îú‚îÄ‚îÄ ab_analysis.ipynb
‚îú‚îÄ‚îÄ model_control.cbm
‚îú‚îÄ‚îÄ model_test.cbm
‚îú‚îÄ‚îÄ views.csv
‚îî‚îÄ‚îÄ likes.csv
```

---

# ‚öô –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ

–°–æ–∑–¥–∞–π—Ç–µ `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
cp .env.example .env
```

–£–∫–∞–∂–∏—Ç–µ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:

```
SQLALCHEMY_DATABASE_URL=postgresql://robot-startml-ro:your_password_here@postgres.lab.karpov.courses:6432/startml
```

‚ö† `.env` –Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ Git.

---

# üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

`requirements.txt` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.

```bash
python -m venv venv
```

Linux / Mac:

```bash
source venv/bin/activate
```

Windows:

```powershell
venv\Scripts\activate
```

–£—Å—Ç–∞–Ω–æ–≤–∫–∞:

```bash
pip install -r requirements.txt
```

---

# ‚ñ∂ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞

```bash
cd part4-ab-testing
uvicorn app:app --reload
```

Swagger:

```
http://127.0.0.1:8000/docs
```

---

# ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

‚úî –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ A/B-—Ä–∞–∑–±–∏–µ–Ω–∏–µ  
‚úî –ü–æ–¥–∫–ª—é—á–µ–Ω—ã –¥–≤–µ –º–æ–¥–µ–ª–∏  
‚úî –°–µ—Ä–≤–∏—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≥—Ä—É–ø–ø—É  
‚úî –ü—Ä–æ–≤–µ–¥—ë–Ω —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑  
‚úî –î–æ–∫–∞–∑–∞–Ω–æ —É–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞

---

# üìå –§–∏–Ω–∞–ª

–ß–∞—Å—Ç—å 4 –∑–∞–≤–µ—Ä—à–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç:

Backend ‚Üí ML ‚Üí DL ‚Üí A/B ‚Üí –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–∑–≤–∏—Ç–∏—é –∏ –¥–∞–ª—å–Ω–µ–π—à–∏–º —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–º. üöÄ
