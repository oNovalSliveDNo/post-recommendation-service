# üöÄ Post Recommendation Service

Production-oriented —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏.

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ ML-—Å–µ—Ä–≤–∏—Å–∞:

> **Backend ‚Üí Feature Engineering ‚Üí ML ‚Üí NLP/DL ‚Üí Online Inference ‚Üí A/B Testing ‚Üí –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è**

---

## üéØ –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞

–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–π —Å–µ—Ä–≤–∏—Å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–π:

* —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ FastAPI
* –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PostgreSQL
* –æ–±—É—á–∞–µ—Ç—Å—è offline
* –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ inference online
* –ø—Ä–æ—Ö–æ–¥–∏—Ç production-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:

  * ‚è± ‚â§ 0.5 —Å–µ–∫ –Ω–∞ –∑–∞–ø—Ä–æ—Å
  * üß† ‚â§ 4 –ì–ë RAM
  * üéØ HitRate@5 > 0.52
  * üöÄ 2000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–µ

---

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

* Python 3.13
* FastAPI
* SQLAlchemy
* PostgreSQL
* CatBoost
* scikit-learn
* PyTorch (DistilBERT)

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–ª—Å—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª—Å—è –Ω–∞ Python 3.13.5

---

## üìö –ü—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç –±—ã–ª —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –≤ —Ä–∞–º–∫–∞—Ö –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã
**Karpov.Courses ‚Äî ¬´–ò–Ω–∂–µ–Ω–µ—Ä –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è (StartML)¬ª**.

–í –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–∞, —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤, –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è production-–∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞ –±—ã–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω—ã –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –±–∞–∑–æ–≤—ã–º–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∫—É—Ä—Å–∞.

---

# üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

## –û–±—â–∞—è —Å—Ö–µ–º–∞

```
PostgreSQL
      ‚Üì
Offline Feature Engineering
      ‚Üì
CatBoost Training
      ‚Üì
Save model (.cbm)
      ‚Üì
Upload features to DB
      ‚Üì
FastAPI Service
      ‚Üì
Online inference (predict_proba ‚Üí top-K)
      ‚Üì
A/B Testing
      ‚Üì
Statistical validation
```

---

# üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```
post-recommendation-service
‚îú‚îÄ‚îÄ part1-baseline
‚îú‚îÄ‚îÄ part2-ml-model
‚îú‚îÄ‚îÄ part3-nlp-enhanced
‚îú‚îÄ‚îÄ part4-ab-testing
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ .env.example
‚îî‚îÄ‚îÄ README.md
```

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑–±–∏—Ç –Ω–∞ 4 –ª–æ–≥–∏—á–µ—Å–∫–∏–µ —á–∞—Å—Ç–∏ ‚Äî —ç–≤–æ–ª—é—Ü–∏—è –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞.

---

# 1Ô∏è‚É£ Part 1 ‚Äî Backend + ORM + Baseline

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** FastAPI, SQLAlchemy ORM, PostgreSQL

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

* ORM-–º–æ–¥–µ–ª–∏ (`User`, `Post`, `Feed`)
* Pydantic-—Å—Ö–µ–º—ã
* endpoint:

  * `/user/{id}`
  * `/post/{id}`
  * `/user/{id}/feed`
  * `/post/{id}/feed`
* baseline —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π:

  ```
  GET /post/recommendations/?limit=10
  ```

  ‚Üí —Ç–æ–ø-N –ø–æ—Å—Ç–æ–≤ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ª–∞–π–∫–æ–≤

–≠—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç —Å–µ—Ä–≤–∏—Å–∞.

üìÅ `part1-baseline/`

---

# 2Ô∏è‚É£ Part 2 ‚Äî ML Model + Production Inference

**–ê–ª–≥–æ—Ä–∏—Ç–º:** CatBoostClassifier  
**–ú–µ—Ç—Ä–∏–∫–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:** HitRate@5

## Offline

* –≤—ã–≥—Ä—É–∑–∫–∞ 10M –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π
* feature engineering
* TF-IDF + PCA –¥–ª—è —Ç–µ–∫—Å—Ç–∞
* user-–ø—Ä–∏–∑–Ω–∞–∫–∏
* –æ–±—É—á–µ–Ω–∏–µ CatBoost
* —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `catboost_ml_model.cbm`
* –≤—ã–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –≤ PostgreSQL

## Online

* –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
* batch-–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
* —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —É–∂–µ –ª–∞–π–∫–Ω—É—Ç—ã—Ö
* `predict_proba`
* top-K —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

üéØ HitRate@5 ‚âà 0.600  
‚è± ~0.5 —Å–µ–∫  
üß† ‚â§ 4 –ì–ë

üìÅ `part2-ml-model/`

---

# 3Ô∏è‚É£ Part 3 ‚Äî NLP + Deep Learning Features

–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–≤—ã–º–∏ –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏.

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ:

* DistilBERT (`distilbert-base-cased`)
* CLS embeddings (768)
* PCA ‚Üí 50 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
* KMeans ‚Üí 15 –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
* CatBoost

### –î–æ–±–∞–≤–ª–µ–Ω–æ:

* `text_cluster`
* —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –¥–æ —Ü–µ–Ω—Ç—Ä–æ–∏–¥–æ–≤
* —É–ª—É—á—à–µ–Ω–Ω—ã–µ NLP-–ø—Ä–∏–∑–Ω–∞–∫–∏

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

üéØ HitRate@5 ‚âà 0.604  
‚úî –£–ª—É—á—à–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ baseline ML  
‚úî Production-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–æ–±–ª—é–¥–µ–Ω—ã

üìÅ `part3-nlp-enhanced/`

---

# 4Ô∏è‚É£ Part 4 ‚Äî A/B Testing

–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–≤—É—Ö –º–æ–¥–µ–ª–µ–π:

* **control** ‚Üí Part 2
* **test** ‚Üí Part 3

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

* –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ 50/50 —Ä–∞–∑–±–∏–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `md5 + salt`
* –∑–∞–≥—Ä—É–∑–∫–∞ –¥–≤—É—Ö –º–æ–¥–µ–ª–µ–π
* –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:

  ```json
  {
    "exp_group": "control",
    "recommendations": [...]
  }
  ```

## –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑

* z-test
* Mann‚ÄìWhitney U
* bucket-based t-test (100 –±–∞–∫–µ—Ç–æ–≤)

### –ò—Ç–æ–≥:

‚úî –†–æ—Å—Ç –¥–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ª–∞–π–∫–æ–º  
‚úî –†–æ—Å—Ç –ª–∞–π–∫–æ–≤ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  
‚úî –†–æ—Å—Ç Hitrate  
‚úî p-value < 0.05  

üìÅ `part4-ab-testing/`

---

# üß† Production-–ø–æ–¥—Ö–æ–¥

* –æ–±—É—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ offline
* —Å–µ—Ä–≤–∏—Å –Ω–µ –¥–µ–ª–∞–µ—Ç —Ç—è–∂—ë–ª—ã—Ö SQL –≤–Ω—É—Ç—Ä–∏ endpoint
* –ø—Ä–∏–∑–Ω–∞–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
* –º–æ–¥–µ–ª—å —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `.cbm`
* —Å–æ–±–ª—é–¥–µ–Ω—ã RAM-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
* —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —É–∂–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤
* –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–¥ HitRate@K (–∞ –Ω–µ AUC)

---

# üîí –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

–ò—Å—Ö–æ–¥–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç –∏ PostgreSQL-–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ä–∞–º–∫–∞—Ö –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã Karpov.Courses –∏ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –¥–æ—Å—Ç—É–ø–µ.

–°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ, —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ë–î –∏ —Å—Ç—Ä–æ–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω—ã –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.

–í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç demo-–¥–∞–Ω–Ω—ã–µ, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞.

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä PostgreSQL –ª–∏–±–æ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø.

---

# ‚öô –£—Å—Ç–∞–Ω–æ–≤–∫–∞

## 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
git clone https://github.com/oNovalSliveDNo/post-recommendation-service.git
cd post-recommendation-service
```

## 2. –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

```bash
python -m venv venv
```

Linux / Mac:

```bash
source venv/bin/activate
```

Windows:

```powershell
venv\Scripts\activate
```

## 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

---

# üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ë–î

–°–æ–∑–¥–∞–π—Ç–µ `.env`:

```bash
cp .env.example .env
```

–£–∫–∞–∂–∏—Ç–µ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:

```
SQLALCHEMY_DATABASE_URL=postgresql://robot-startml-ro:your_password@postgres.lab.karpov.courses:6432/startml
```

‚ö† `.env` –Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ Git.

---

# ‚ñ∂ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞

–ü—Ä–∏–º–µ—Ä –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏:

```bash
cd part4-ab-testing
uvicorn app:app --reload
```

Swagger:

```
http://127.0.0.1:8000/docs
```

---

# üìä –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏

| –≠—Ç–∞–ø     | HitRate@5 |
| -------- | --------- |
| Baseline | ~0.52     |
| ML       | ~0.600    |
| NLP + DL | ~0.604    |

A/B-—Ç–µ—Å—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ.

---

# üöÄ –ò—Ç–æ–≥

–ü—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç:

* –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É production ML-—Å–µ—Ä–≤–∏—Å–∞
* —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ offline / online
* —Ä–∞–±–æ—Ç—É —Å –±–æ–ª—å—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (10M+ —Å—Ç—Ä–æ–∫)
* –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –ø–æ–¥ –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫—É
* –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π A/B-—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç
* —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
